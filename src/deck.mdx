import {
  Head,
  Header,
  Footer,
  Steps,
  Notes,
  // Layouts
  Layout,
  Invert,
  Split,
  SplitRight,
  Horizontal,
  FullScreenCode,
} from "mdx-deck";
import { themes } from "mdx-deck";
import myTheme, { stateTheme, reviewTheme } from "./theme";
export const theme = {
  ...themes.prism,
  ...myTheme,
};
import "tailwindcss/tailwind.css";
import "./styles/index.css";

import { CodeSurfer, CodeSurferColumns, Step as CodeStep } from "code-surfer";
import {
  nightOwl,
  duotoneDark,
  oceanicNext,
  shadsOfPurple,
  vsDark,
} from "@code-surfer/themes";

import MainContent from "./components/MainContent";
import Grid from "./components/Grid";
import BasicGrid from "./components/BasicGrid";
import GridItem from "./components/GridItem";
import Bullets from "./components/Bullets";
import IframeLoader from "./components/IframeLoader";
import CodeSandboxCharts from "./components/CodeSandboxCharts";
import colors, { colorMap } from "./styles/colors";

<Head>
  <title>React CrashCourse</title>
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="@jxnblk" />
  <meta name="twitter:title" content="React Crash Course" />
  <meta name="twitter:description" content="UX Forum on React Fundamentals" />
  <meta name="twitter:image" content="https://example.com/card.png" />
</Head>
<Header className="Header">React CrashCourse</Header>
<Footer className="Footer">UX Forum (March 2021)- Craig Curtis</Footer>

<!-- PAGE 1 - intro-->

# React CrashCourse

<MainContent>
  <BasicGrid gridAutoFlow="column">
    <Steps>
      <div className="box box-badass p-2 text-center">
        <span>Classes</span>
      </div>
      <div className="box box-badass p-2 text-center">
        <span>Hooks</span>
      </div>
      <div className="box box-uranianBlue p-2 text-center">
        <span>Context</span>
      </div>
      <div className="box box-uranianBlue p-2 text-center">
        <span>Redux</span>
      </div>
      <div className="box box-uranianBlue p-2 text-center">
        <span>Redux Toolkit</span>
      </div>
      <div className="box box-sandyBrown p-2 text-center">
        <span>Gotchas</span>
      </div>
      <div className="box box-sandyBrown p-2 text-center">
        <span>Q&A</span>
      </div>
      <div className="box box-sandyBrown p-2 text-center">
        <span>Activity</span>
      </div>
    </Steps>
  </BasicGrid>
</MainContent>

<Notes>

- React CrashCourse
- Go for the basics of React
- Not enough if just do one tutorial
- Need Classes for legacy projects and 3rd party plugins
- Understand Hooks for modern React
- Understand Redux for legacy, and as a state option
- Learn Context as a simpler Redux alternative - old and new
- Common Gotchas

</Notes>

---

# Foundational Knowledge:

<div>

<div style={{margin: '0 auto'}}>

## Required

- HTML
- CSS
- JavaScript

</div>
<div style={{margin: '0 auto'}}>

## Helpful

- TypeScript
- Node
- Webpack

</div>
</div>

---

<!-- React Components example with React + D3-->

# Components Example: React + D3

<CodeSandboxCharts />

<Notes>

- Made with Codesandbox - set up with Create React App
- Everything is a component
- New syntax - HTML in JS, possibly CSS in JS
- Entry point - public.html
- Entry point - index.js (bottom), usually App.js too
- .js, .jsx, .tsx
- Holy Grail layout - prevent header, sidebar flashing

</Notes>

---

<!-- Page - Class-based React -->

# Class-based React

<MainContent>
  <BasicGrid gridAutoFlow="row">
    <Steps>
      <div className="box box-badass p-2 text-center">
        <span>Class structure</span>
      </div>
      <div className="box box-badass p-2 text-center">
        <span>JSX</span>
      </div>
      <div className="box box-badass p-2 text-center">
        <span>Props</span>
      </div>
      <div className="box box-badass p-2 text-center">
        <span>State</span>
      </div>
      <div className="box box-badass p-2 text-center">
        <span>Lifecycle Hooks</span>
      </div>
      <div className="box box-badass p-2 text-center">
        <span>Hoisting State</span>
      </div>
      <div className="box box-badass p-2 text-center">
        <span>HOCs</span>
      </div>
      <div className="box box-badass p-2 text-center">
        <span>refs</span>
      </div>
      <div className="box box-badass p-2 text-center">
        <span>PropTypes, TypeScript</span>
      </div>
    </Steps>
  </BasicGrid>
</MainContent>

<Notes>

- Classes for legacy, make you a stronger React developer
- Basics of React
- Main points of Classes
- Quick dive / snorkeling into TypeScript

</Notes>

---

# Why Classes?

<MainContent>
  <BasicGrid columns={1}>
    <GridItem>Legacy Projects</GridItem>
    <GridItem>3rd Party Plugins</GridItem>
    <GridItem>Still Supported</GridItem>
    <GridItem>React docs and tutorials still largely use classes</GridItem>
  </BasicGrid>
</MainContent>

<Notes>

- (( Compare with Traditional and Simplified Chinese ))

</Notes>

---

# React Class Structure

<CodeSurferColumns themes={[nightOwl,nightOwl]}>

<CodeStep>

```js showNumbers title="./src/App.js"
import React from "react";
```

- Import React

</CodeStep>

<CodeStep>

```js showNumbers title="./src/App.js"
import React from "react";

class App extends React.Component {
  constructor(props) {
    super(props);
  }
}

export default App;
```

- Import React, Component
- Create class, add constructor

</CodeStep>

<CodeStep>

```js showNumbers title="./src/App.js"
import React, { Component } from "react";

class App extends Component {
  constructor(props) {
    super(props);
  }
}

export default App;
```

- Import React, Component
- Create class, add constructor
- Minor refactor - destructuring the Component import

</CodeStep>

<CodeStep>

```js showNumbers title="./src/App.js"
import React, { Component, Fragment } from "react";

class App extends Component {
  constructor(props) {
    super(props);
  }

  render() {
    return (
      <div className="App">
        <Fragment>
          <h1>My App</h1>
          {/* Comment add more components */}
        </Fragment>
      </div>
    );
  }
}

export default App;
```

- Import React, Component
- Create class, add constructor
- Minor refactor - destructuring the Component import
- render the JSX (notice syntax)

</CodeStep>

<CodeStep>

```js showNumbers title="./src/App.js"
import React, { Component } from "react";

class App extends Component {
  constructor(props) {
    super(props);
  }

  render() {
    return (
      <div className="App">
        <>
          <h1>My App</h1>
          {/* Comment add more components */}
        </>
      </div>
    );
  }
}

export default App;
```

- Import React, Component
- Create class, add constructor
- Minor refactor - destructuring the Component import
- render the JSX (notice syntax)
- Minor refactor - use Fragment shorthand

</CodeStep>

<CodeStep>

```js showNumbers title="./src/App.js"
import React, { Component } from "react";

class App extends Component {
  constructor(props) {
    super(props);
  }

  render() {
    return (
      <div className="App">
        <>
          <h1>My App</h1>
          {/* Comment add more components */}
        </>
      </div>
    );
  }
}

export default App;
```

- Import React, Component
- Create class, add constructor
- Minor refactor - destructuring the Component import
- render the JSX (notice syntax)
- Minor refactor - use Fragment shorthand
- This is setup in CRA, let's look at entry point

</CodeStep>

</CodeSurferColumns>

<Notes>

- Explain import export destructuring
- constructor and constructorless (coming later)
- className vs. class
- JSX = HTML in render function

</Notes>

---

<!-- Page - Classes Entry Point -->

# React Entry Point

<IframeLoader
  src={`https://codesandbox.io/embed/relaxed-chatelet-nnxgj?autoresize=1&codemirror=1&fontsize=14&hidenavigation=1&theme=dark`}
  title={`Basic CRA Template`}
/>

- Notice App.js, slightly different syntax
- Dive into ./src/index.js, connecting to the DOM
- Dive into ./public/index.html, DOM id entry point at #root

<Notes>

- App.js export default, function vs. const
- index.js - BTW grabbing DOM
- index.html - div#root

</Notes>

---

# JSX

<CodeSurferColumns themes={[nightOwl,nightOwl]}>

<CodeStep>

```js showNumbers title="./src/Header.jsx" 9:15
import React, { Component } from "react";
import styles from "./Header.module.scss";

class Header extends Component {
  constructor(props) {
    super(props);
  }

  render() {
    return (
      <header>
        <span>My Title</span>
      </header>
    );
  }
}

export default Header;
```

- render function to return HTML-like JSX

</CodeStep>

<CodeStep>

```js showNumbers title="./src/Header.jsx" 4,11
import React, { Component } from "react";
import styles from "./Header.module.scss";

class Header extends Component {
  constructor(props) {
    super(props);
  }

  render() {
    return (
      <header className={`header ${styles.Header}`}>
        <span>My Title</span>
      </header>
    );
  }
}

export default Header;
```

- render function to return HTML-like JSX
- className vs. class

</CodeStep>

<CodeStep>

```js showNumbers title="./src/Header.jsx" 12:13
import React, { Component } from "react";
import styles from "./Header.module.scss";

class Header extends Component {
  constructor(props) {
    super(props);
  }

  render() {
    return (
      <header className={`header ${styles.Header}`}>
        <label htmlFor="myInput">Search:</label>
        <input id="myInput" type="text" />
      </header>
    );
  }
}

export default Header;
```

- render function to return HTML-like JSX
- className vs. class
- htmlFor vs. for

</CodeStep>

<CodeStep>

```js showNumbers title="./src/Header.jsx"
import React, { Component } from "react";
import styles from "./Header.module.scss";

class Header extends Component {
  constructor(props) {
    super(props);
  }

  handleChange(e) {
    console.log(e.target.value);
  }
  clear() {
    alert("cleared");
  }
  handlePlay() {...}

  render() {
    return (
      <header className={`header ${styles.Header}`}>
        <label htmlFor="myInput">Search:</label>
        <input
          id="myInput"
          type="text"
          onChange={(e) => this.handleChange(e)}
        />
        <button onClick={this.clear}>X</button>
        <video
          src={`...`}
          canplay={this.handlePlay}
        />
      </header>
    );
  }
}

export default Header;
```

- render function to return HTML-like JSX
- className vs. class
- htmlFor vs. for
- on events (check MDN events)

</CodeStep>

<CodeStep>

```js showNumbers title="./src/Header.jsx"
import React, { Component } from "react";
import styles from "./Header.module.scss";

class Header extends Component {
  constructor(props) {
    super(props);
  }

  handleChange(e) {
    console.log(e.target.value);
  }
  clear() {
    alert("cleared");
  }
  handlePlay() {...}

  render() {
    const results = [
      {id: 1, name: 'apple'},
      {id: 2, name: 'banana'},
    ];

    return (
      <header className={`header ${styles.Header}`}>
        <label htmlFor="myInput">Search:</label>
        <input
          id="myInput"
          type="text"
          onChange={(e) => this.handleChange(e)}
        />
        <button onClick={this.clear}>X</button>
        <video
          src={`...`}
          canplay={this.handlePlay}
        />
        <ul>
          {results.map( (result) => {
            return (
              <li key={result.id}>{result.name}</li>
            );
          })}
        </ul>
      </header>
    );
  }
}

export default Header;
```

- render function to return HTML-like JSX
- className vs. class
- htmlFor vs. for
- on events (check MDN events)
- mapping lists, keys

</CodeStep>

<CodeStep>

```js showNumbers title="./src/Header.jsx"
import React, { Component } from "react";
import styles from "./Header.module.scss";

class Header extends Component {
  constructor(props) {
    super(props);
  }

  handleChange(e) {
    console.log(e.target.value);
  }
  clear() {
    alert("cleared");
  }
  handlePlay() {...}

  render() {
    const results = [
      {id: 1, name: 'apple'},
      {id: 2, name: 'banana'},
    ];

    return (
      <header className={`header ${styles.Header}`}>
        <label htmlFor="myInput">Search:</label>
        <input
          id="myInput"
          type="text"
          onChange={(e) => this.handleChange(e)}
        />
        <button onClick={this.clear}>X</button>
        <video
          src={`...`}
          canplay={this.handlePlay}
        />
        <ul>
          {results.map( result => (
            <li key={result.id}>{result.name}</li>
          ))}
        </ul>
      </header>
    );
  }
}

export default Header;
```

- render function to return HTML-like JSX
- className vs. class
- htmlFor vs. for
- on events (check MDN events)
- mapping lists, keys
- refined syntax for maps

</CodeStep>

<CodeStep>

```js showNumbers title="./src/Header.jsx" 24:33
import React, { Component } from "react";
import styles from "./Header.module.scss";

class Header extends Component {
  constructor(props) {
    super(props);
  }

  handleChange(e) {
    console.log(e.target.value);
  }
  clear() {
    alert("cleared");
  }
  handlePlay() {...}

  render() {
    const results = [
      {id: 1, name: 'apple'},
      {id: 2, name: 'banana'},
    ];

    return (
      <>
        <header className={`header ${styles.Header}`}>
          ...
        </header>
        <video
          className={`${styles.Video}`}
          src={`...`}
          canplay={this.handlePlay}
        />
      </>
    );
  }
}

export default Header;
```

- render function to return HTML-like JSX
- className vs. class
- htmlFor vs. for
- on events (check MDN events)
- mapping lists, keys
- refined syntax for maps
- fragments - must be 1 parent wrapper element

</CodeStep>

<CodeStep>

```js showNumbers
import React, { Component } from "react";
import isEmpty from "lodash/isEmpty";
import styles from "./Header.module.scss";

class Header extends Component {
  render() {
    const { results, hasError } = this.props;

    return (
      <>
        {
          isEmpty(results) ? (
            <header>...</header>
          ) : (
            <video>...</video>
          );
        }
        {hasError ? (<Alert type="danger" />) : null}
        {hasSuccess && (<Alert type="success" />")}
      </>
    );
  }
}

export default Header;
```

- render function to return HTML-like JSX
- className vs. class
- htmlFor vs. for
- on events (check MDN events)
- mapping lists, keys
- refined syntax for maps
- fragments - must be 1 parent wrapper element
- ? () : (), &&, null

</CodeStep>

<CodeStep>

```js showNumbers
...
const newObject = {
  ...oldObject,
  { active: true }
};

const newArray = [
  ...oldArray,
  { id: 100, 'zucchini'}
];
```

- render function to return HTML-like JSX
- className vs. class
- htmlFor vs. for
- on events (check MDN events)
- mapping lists, keys
- refined syntax for maps
- fragments - must be 1 parent wrapper element
- ? () : (), &&, null
- new objects and arrays with spread syntax ...

</CodeStep>

</CodeSurferColumns>

<Notes>

- (( just go through bullets ))
- types of fragments - cannot add props, just organizational
- returning null for no JSX

</Notes>

---

# Props

<Horizontal>

- Data Down - Data into components
- Events Up - Functions notifying parent components
- Dangers of the Prop drilling anti-pattern

</Horizontal>

<Notes>

- props are HTML custom attributes

</Notes>

---

# Class Props

<CodeSurferColumns themes={[nightOwl,nightOwl]}>

<CodeStep>

```js showNumbers 9:12,16,22:37
import React, { Component } from "react";

class App extends Component {
  constructor(props) {
    super(props);
  }

  render() {
    const results = [
      { id: 1, name: "apple" },
      { id: 2, name: "banana" },
    ];

    return (
      <div>
        <Header title="My App" results={results} />
      </div>
    );
  }
}

class Header extends Component {
  constructor(props) {
    super(props);
  }

  render() {
    return (
      <>
        <header>{this.props.title}</header>
        {this.props.results.map((result) => (
          <p>{result.name}</p>
        ))}
      </>
    );
  }
}

export default App;
```

- data down (title, results)

</CodeStep>

<CodeStep>

```js showNumbers
import React, { Component } from "react";

class App extends Component {
  constructor(props) {
    super(props);
  }

  render() {
    const results = [
      { id: 1, name: "apple" },
      { id: 2, name: "banana" },
    ];

    return (
      <div>
        <Header title="My App" results={results} />
      </div>
    );
  }
}

class Header extends Component {
  constructor(props) {
    super(props);
  }

  render() {
    const { title, results } = this.props;

    return (
      <>
        <header>{title}</header>
        {results.map((result) => (
          <p>{result.name}</p>
        ))}
      </>
    );
  }
}

export default App;
```

- data down (title, results)
- refined destructuring

</CodeStep>

<CodeStep>

```js showNumbers
import React, { Component } from "react";

class App extends Component {
  handleItemClicked(id) {...}
  handleToggleMenu() {...}

  render() {
    ...
    return (
      <div>
        <Header
          ...
          onItemClicked={(id) => this.handleItemClicked(id)}
          onToggleMenu={() => this.handleToggleMenu()}
        />
      </div>
    );
  }
}

class Header extends Component {
  ...
  render() {
    const {
      ...
      onItemClicked,
      onToggleMenu
    } = this.props;

    return (
      <>
        <header>
          ...
          <button onClick={() => onToggleMenu()}>Menu</button>
        </header>
        {results.map((result) => (
          <p onClick={() => onItemClicked(result.id)}>{result.name}</p>
        ))}
      </>
    );
  }
}

export default App;
```

- data down (title, results)
- refined destructuring
- events up, (optional params)

</CodeStep>

<CodeStep>

```js showNumbers title="Prop Drilling"
  {/* App */}
  ...
  render() {
    return (
      <div className="App">
        <HeaderButton isMenuOpen{false} />
      </div>
    );
  }
  ...
  {/* Header */}
  ...
  render() {
    return (
      <header className="Header">
        <HeaderButton isMenuOpen{this.props.isMenuOpen} />
      </header>
    );
  }
  {/* Header Button */}
  ...
  render() {
    return (
      <button className="HeaderButton">
        <HeaderButtonIcon isMenuOpen{this.props.isMenuOpen} />
      </button>
    );
  }
  {/* Header Button Icon */}
  render() {
    return (
      <span className="HeaderButtonIcon">
        {this.props.isMenuOpen ? 'Open' : 'Closed'}
      </span>
    );
  }
```

- data down (title, results)
- refined destructuring
- events up, (optional params)
- Dangers of Prop Drilling (solved with Redux or Context)

</CodeStep>

</CodeSurferColumns>

<Notes>

- props are powerful
- but can be too powerful

</Notes>

---

# Class State

<Horizontal>

- Stores data for a component - input, actions, flags, progress, API data
- Retains across renders
- Can be passed down as props to child components

</Horizontal>

<Notes>

- State for tracking variablles
- Common uses - user input, actions, flags, progress, API data
- Can be passed down AS PROPS to child components

</Notes>

---

# Class State Code

<CodeSurferColumns themes={[nightOwl,nightOwl]}>

<CodeStep>

```js showNumbers
class App extends Component {
  constructor(props) {
    super(props);

    state = {
      isMenuOpen: false,
      results: [],
    };
  }
}
```

- Set default in constructor

</CodeStep>

<CodeStep>

```js showNumbers
class App extends Component {
  state = {
    isMenuOpen: false,
    results: [],
  };
}
```

- Set default in constructor
- OR no constructor syntax

</CodeStep>

<CodeStep>

```js showNumbers
class App extends Component {
  state = {
    isMenuOpen: false,
    results: [],
  };

  handleToggleMenu() {
    const { isMenuOpen } = this.state;
    setState({ isMenuOpen: !isMenuOpen });
  }

  setResults(results) {
    setState({ results });
  }
}
```

- Set default in constructor
- OR no constructor syntax
- Change values with setState

</CodeStep>

<CodeStep>

```js showNumbers
class App extends Component {
  state = {
    isMenuOpen: false,
    results: [],
  };

  handleToggleMenu() {
    setState((prevState) => {
      const { isMenuOpen } = this.state;
      return {
        isMenuOpen: !prevState.isMenuOpen,
      };
    });
  }

  setResults(results) {
    // prettier-ignore
    setState(() => ({
      results: prevState.isMenuOpen
          ? results
          : prevState.results,
    }));
  }
}
```

- Set default in constructor
- OR no constructor syntax
- Change values with setState
- setState callback (ensure state is changed, since is async)

</CodeStep>

</CodeSurferColumns>

<Notes>

- constructor and constructorless
- setState - async, can make "sync" with cb
- cb setState to debug if state not updating

</Notes>

---

# Class Lifecycle Hooks

<BasicGrid columns={3} rows={1}>
  <GridItem>
    <h3>Mounting</h3>
    <ol>
      <li>constructor</li>
      <li>render</li>
      <li>componentDidMount</li>
    </ol>
  </GridItem>
  <GridItem>
    <h3>Updating</h3>
    <ol>
      <li>render</li>
      <li>componentDIdUpdate</li>
    </ol>
  </GridItem>
  <GridItem>
    <h3>Unmounting</h3>
    <ol>
      <li>componentWillUnmount</li>
    </ol>
  </GridItem>
</BasicGrid>

<IframeLoader
  src={`https://projects.wojtekmaj.pl/react-lifecycle-methods-diagram/`}
  title={`React Lifecycle Methods`}
/>

<Notes>

- These are most common lifecycle Hooks
- Many deprecated, others very uncommon

</Notes>

---

# componentDidMount

<Horizontal>

- API Calls
- Animations
- Listeners

</Horizontal>

<Notes>

- AngularJS $onInit)()
- Angular ngAfterContentInit
- Vue mounted

</Notes>

---

# Class Lifecycle - componentDidMount

<CodeSurferColumns themes={[nightOwl,nightOwl]}>

<CodeStep>

```js showNumbers
import React, { Component } from 'react';
import isEmpty from 'lodash/isEmpty';

class BookList extends Component {
  state = {
    books: []; // [ {id: number, title: string} ]
    loadState: null; // 'loading', 'success', 'error'
  }

  render() {
    const { books, loadState } = this.state;
    return (
      <></>
    );
  }
}
```

<div>

## API Calls, Animations

- Set up basic component

</div>

</CodeStep>

<CodeStep>

```js showNumbers
import React, { Component } from 'react';
import isEmpty from 'lodash/isEmpty';

class BookList extends Component {
  state = {
    books: []; // [ {id: number, title: string} ]
    loadState: null; // 'loading', 'success', 'error'
  }

  componentDidMount() {
    cosnt { bookListId } = this.props;

    this.setState({loadState: 'loading'});

    fetch(`https://api.com/${bookListId}`)
      .then(res => res.json())
      .then(data => this.setState({ books: data, loadState: 'success' }))
      .catch(error => {
        console.error(error);
        this.setState({ loadState: 'error' })
      })
  }

  render() {
    const { books, loadState } = this.state;
    return (
      <></>
    );
  }
}
```

<div>

## API Calls, Animations

- Set up basic component
- Add componentDidMount method

</div>

</CodeStep>

<CodeStep>

```js showNumbers
import React, { Component } from 'react';
import isEmpty from 'lodash/isEmpty';

class BookList extends Component {
  state = {
    books: []; // [ {id: number, title: string} ]
    loadState: null; // 'loading', 'success', 'error'
  }

  async componentDidMount() {
    cosnt { bookListId } = this.props;

    this.setState({loadState: 'loading'});

    try {
      const booksRes = await fetch(`https://api.com/${bookListId}`);
      const books = await booksRes.json();
      this.setState({ books, loadState: 'success'});
    } catch(error) {
      console.error(error);
      this.setState({ loadState: 'error' });
    }

  }

  render() {
    const { books, loadState } = this.state;
    return (
      <></>
    );
  }
}
```

<div>

## API Calls, Animations

- Set up basic component
- Add componentDidMount method
- Refine with async await

</div>

</CodeStep>

<CodeStep>

```js showNumbers
import React, { Component } from 'react';
import isEmpty from 'lodash/isEmpty';
import styles from './BookList.module.scss';

class BookList extends Component {
  state = {
    books: []; // [ {id: number, title: string} ]
    loadState: null; // 'loading', 'success', 'error'
  }

  async componentDidMount() {
    cosnt { bookListId } = this.props;

    this.setState({loadState: 'loading'});

    try {
      const booksRes = await fetch(`https://api.com/${bookListId}`);
      const books = await booksRes.json();
      this.setState({ books, loadState: 'success'});
    } catch(error) {
      console.error(error);
      this.setState({ loadState: 'error' });
    }

  }

  render() {
    const { books, loadState } = this.state;
    return (
      <>
        {switch(true) {
          case loadState === 'loading':
            return (<div className={styles.Loading} />);
          case loadState === 'error':
            return (<div className={styles.Error}>Error</div>);
          case loadState === 'success' && !isEmpty(books):
            return (
              <div className={styles.BookList}>
                {books.map( b => (
                  <div className={styles.Book}>...</div>
                ))}
              </div>
            );
          case loadState === 'success' && isEmpty(books):
          default:
            return (<div className={styles.Placeholder} />)
        }}
      </>
    );
  }
}
```

<div>

## API Calls, Animations

- Set up basic component
- Add componentDidMount method
- Refine with async await
- Add the JSX

</div>

</CodeStep>

</CodeSurferColumns>

<Notes>

- note async await use try catch blocks

</Notes>

---

# componentDidUpdate

<Horizontal>

- watch props changes
- watch state changes
- not called on initial render

</Horizontal>

<Notes>

- used when props or state change

</Notes>

---

# Class Lifecycle - componentDidUpdate

<CodeSurferColumns themes={[nightOwl,nightOwl]}>

<CodeStep>

```js showNumbers
import React, { Component } from "react";

class BookList extends Component {
  componentDidMount() {
    console.log(this.props.isAuthenticated);
    {/* API call */}
  };
  render() { return ...};
}

```

- Assume isAuthenticated is a prop passed in...

</CodeStep>

<CodeStep>

```js showNumbers
import React, { Component } from "react";

class BookList extends Component {
  componentDidMount() { {/* API call */} };

  componentDidUpdate(prevProps, prevState) {
    const { isAuthenticated } = this.props;
    const wasAuthenticated = prevProps.isAuthenticated;

    if (wasAuthenticated && !isAuthenticated) {
      this.removeData();
    }
    if (!wasAuthenticated && isAuthenticated) {
      this.loadData();
    }
  }

  render() { return ...};
}

```

- Assume isAuthenticated is a prop passed in
- use componentDidUpdate to watch for props or state changes

</CodeStep>

</CodeSurferColumns>

<Notes>

- Call functions accordingly with different props or state

</Notes>

---

# componentWillUnmount

<Horizontal>

- Cleanup functions
- Clearing intervals, timeouts
- Removing event listeners

</Horizontal>

<Notes>

- often neglected - for performance, memory leaks

</Notes>

---

# Class Lifecycle - componentWillUnmount

<CodeSurferColumns themes={[nightOwl,nightOwl]}>

<CodeStep>

```js showNumbers
class Chart extends Component {
  componentDidMount() {
    this.loadChart();
  }
  componentDidUpdate() {
    this.updateChart();
  }
}
```

- Used for cleanup functions

</CodeStep>

<CodeStep>

```js showNumbers
class Chart extends Component {
  componentDidMount() {
    this.loadChart();
  }
  componentDidUpdate() {
    this.updateChart();
  }
  componentWillUnmount() {
    this.destroyChart();
  }
}
```

- Used for cleanup functions

</CodeStep>

<CodeStep>

```js showNumbers
class Chart extends Component {
  private _interval: number = null;

  componentDidMount() { //
    this._interval = window.setInterval(() => {
      this.pingServer();
    }, 60000);
  }

  componentWillUnmount() { //
    window.clearInterval(this._interval);
  }
}
```

- Used for cleanup functions
- and clearing intervals, timeouts

</CodeStep>

<CodeStep>

```js showNumbers
class WindowEventWrapper extends Component {
  componentDidMount() {
    window.addEventListener("blur", this.onWindowBlurred);
    window.addEventListener("focus", this.onWindowFocused);
  }

  componentWillUnmount() {
    window.removeEventListener("blur", this.onWindowBlurred);
    window.removeEventListener("focus", this.onWindowFocused);
  }
}
```

- Used for cleanup functions
- and clearing intervals, timeouts
- and event listeners

</CodeStep>

</CodeSurferColumns>

<Notes>

- BTW components can just return functionality, not just JSX

</Notes>

---

# Hoisting State + Functional Components

<Horizontal>

- Hoisting up state to parent components
- Child components are Functional components, not Classes
- Function components had no state (prior to React v.16.8)

</Horizontal>

---

# Hoisting State + Functional Components

<CodeSurferColumns themes={[nightOwl,nightOwl]}>

<CodeStep>

```js showNumbers
class App extends Component {
  state = {
    isDarkMode: false,
  };

  render() {
    return (
      <div>
        <UserSettings />
      </div>
    );
  }
}
```

- Common to have state in App.js for small projects

</CodeStep>

<CodeStep>

```js showNumbers
class App extends Component {
  state = {
    isDarkMode: false,
  };
  handleToggleDarkMode() {
    const { isDarkMode } = this.state;
    this.setState({ isDarkMode: !isDarkMode });
  }

  render() {
    const { isDarkMode } = this.state;
    return (
      <div>
        <UserSettings
          isDarkMode={isDarkMode}
          onToggleDarkMode={this.handleToggleDarkMode}
        />
      </div>
    );
  }
}

<!-- prettier-ignore -->
const UserSettings = ({
  isDarkMode = false,
  onToggleDarkMode,
}) => (
  <div className={
    `${styles.UserSettings} ${isDarkMode ? "isDarkMode" : ""}`
  }>
    <button onClick={() => onToggleDarkMode()}>...</button>
  </div>
);
```

- Common to have state in App.js for small projects
- Child components are typically functional components / dumb components (notice syntax)

</CodeStep>

<CodeStep>

```js showNumbers
class App extends Component {
  state = {
    books: null,
  };

  render() {
    const { books } = this.state;
    return (
      <div>
        <BookList books={books} />
      </div>
    );
  }
}

const BookList = ({ books=[] }) => {
  if (isEmpty(books)) return null;
  const sortedBooks = books.sort( (a,b) -> b.date - a.date );

  return (
    <ul>
      {sortedBooks.map( b => (
        <li key={b.id}>{b.title} - {b.date}</li>
      ))}
    </ul>
  );
}
```

- Common to have state in App.js for small projects
- Child components are typically functional components / dumb components (notice syntax)
- Logic can be handled before returns

</CodeStep>

</CodeSurferColumns>

---

# HOCs - Higher Order Components

<Horizontal>

- HOC = a function that takes a component and returns a new component
- React Router withRouter()
- Redux connect()()
- React Soundplayer withCustomAudio()
- Material UI withStyles()

</Horizontal>

---

# HOCs - Higher Order Components

<CodeSurferColumns themes={[nightOwl,nightOwl]}>

<CodeStep>

```js showNumbers
import React from "react";
import { withRouter } from "react-router";

class ShowTheLocation extends React.Component {
  render() {
    const { match, location, history } = this.props;

    return (
      <div>
        <span>You are now at&#32;</span>
        <span>{location.pathname}</span>
      </div>
    );
  }
}

const ShowTheLocationWithRouter = withRouter(ShowTheLocation);
```

- withRouter in React Router

</CodeStep>

<CodeStep>

```js showNumbers
import { connect } from "react-redux";
import isEmpty from 'lodash/isEmpty';
class MyComponent extends Component {
  render() {
    const { isDarkMode, users, onUserClicked } = this.props; // from store
    return (
      <div className={`${isDarkMode ? 'dark' : ''}`}>
        {!isEmpty(users) && (
          <ul>
            {users.map( u => (
              <li
                key={u.id}
                onClick={() => onUserClicked(u.id)}
              >
                {u.name}
              </li>
            ))}
          </ul>
        )}
      </div>
    );
  }
}

const mapStateToProps = (store) => {
  isDarkMode: store.isDarkMode,
  users: store.users,
};

const mapDispatchToProps = dispatch => ({
  onUserClicked: (id) => dispatch({ type: 'USER_CLICKED', value: id})
});

const ConnectedMyComponent = connect(
  mapStateToProps,
  mapDispatchToProps
)(MyComponent);
export default ConnectedMyComponent;
```

- withRouter in React Router
- connect function in Redux

</CodeStep>

<CodeStep>

```js showNumbers
...
class WrappedComponent extends Component {...}

export default withRouter
  (connect(
    mapStateToProps,
    mapDispatchToProps
  )(WrappedComponent)
);
```

- withRouter in React Router
- connect function in Redux
- OR both React Router and Redux

</CodeStep>

<CodeStep>

```js showNumbers
import React, { Component } from "react";
import {
  PlayButton,
  Timer,
  Progress,
  VolumeControl,
} from "react-soundplayer/components";
import { withCustomAudio } from "react-soundplayer/addons";

interface ICustomAudioPlayerProps {
  onCanPlayTrack: (time: number) => {};
  onStartTrack: () => {};
  onPauseTrack: () => {};
  onStopTrack: () => {};
  currentTime: number;
  duration: number;
  hasSetStartTime: boolean;
  isMuted: boolean;
  playing: boolean;
  preloadType: string;
  seeking: boolean;
  soundCloudAudio: any;
  streamUrl: string;
  volume: number;
  jumpToTime: number;
}

class CustomAudioPlayer extends Component<ICustomAudioPlayerProps, {}> {
  render() {
    return (
      <div className={`${styles.CustomAudioPlayer}`}>
        <PlayButton {...this.props} />
        <Timer {...this.props} />
        <Progres {...this.props} />
        <VolumeControl {...this.props} />
      </div>
    );
  }
}

const CustomAudioPlayer = withCustomAudio(InnerCustomAudioPlayer);
export default CustomAudioPlayer;
```

- withRouter in React Router
- connect function in Redux
- OR both React Router and Redux
- react-soundplayer

</CodeStep>

<CodeStep>

```js showNumbers
import React from "react";
import PropTypes from "prop-types";
import { withStyles } from "@material-ui/core/styles";
import Button from "@material-ui/core/Button";

const styles = {
  root: {
    background: "linear-gradient(45deg, #FE6B8B 30%, #FF8E53 90%)",
    border: 0,
    borderRadius: 3,
    boxShadow: "0 3px 5px 2px rgba(255, 105, 135, .3)",
    color: "white",
    height: 48,
    padding: "0 30px",
  },
};

function HigherOrderComponent(props) {
  const { classes } = props;
  return <Button className={classes.root}>Higher-order component</Button>;
}

HigherOrderComponent.propTypes = {
  classes: PropTypes.object.isRequired,
};

export default withStyles(styles)(HigherOrderComponent);
```

- withRouter in React Router
- connect function in Redux
- OR both React Router and Redux
- react-soundplayer
- material-ui withStyles

</CodeStep>

</CodeSurferColumns>

---

# refs

<Horizontal>

- For DOM manipulation - focus/blur, media events
- For storing values
- Do not overuse refs

</Horizontal>

---

# Class refs

<CodeSurferColumns themes={[nightOwl,nightOwl]}>

<CodeStep>

```js showNumbers
import React, { Component } from "react";

class CustomTextInput extends React.Component {
  constructor(props) {
    super(props);
  }

  render() {
    return (
      <div>
        <input type="text" />
        <button>
          Focus the text input
        </button
      </div>
    );
  }
}

export default CustomTextInput;
```

- Start with simple component

</CodeStep>

<CodeStep>

```js showNumbers
import React, { Component } from "react";

class CustomTextInput extends React.Component {
  constructor(props) {
    super(props);
    this.textInput = React.createRef();
    this.focusTextInput = this.focusTextInput.bind(this);
  }

  focusTextInput() {
    this.textInput.current.focus();
  }

  render() {
    return (
      <div>
        <input
          type="text"
          ref={this.textInput} />
        <button
          onClick={this.focusTextInput}
        >
          Focus the text input
        </button
      </div>
    );
  }
}

export default CustomTextInput;
```

- Start with simple component
- Create ref in constructor, add ref to DOM element

</CodeStep>

<CodeStep>

```js showNumbers
import React, { Component } from "react";

class CustomTextInput extends Component {
  _textInput = React.createRef();

  focusTextInput() {
    this._textInput.current.focus();
  }

  render() {
    return (
      <div>
        <input type="text" ref={this._textInput} />
        <button onClick={() => this.focusTextInput()}>
          Focus the text input
        </button>
      </div>
    );
  }
}

export default CustomTextInput;
```

- Start with simple component
- Create ref in constructor, add ref to DOM element
- Refine with constructorless syntax

</CodeStep>

<CodeStep>

```js showNumbers
import React, { Component } from "react";

class CustomTextInput extends Component {
  focusTextInput() {
    this._textInput.current.focus();
  }

  render() {
    return (
      <div>
        <input type="text" ref={(node) => (this._textInput = node)} />
        <button onClick={() => this.focusTextInput()}>
          Focus the text input
        </button>
      </div>
    );
  }
}

export default CustomTextInput;
```

- Start with simple component
- Create ref in constructor, add ref to DOM element
- Refine with constructorless syntax
- Other common syntax for refs - no createRef

</CodeStep>

<CodeStep>

```js showNumbers
const Input = ({ inputRef }) => {
  return <input type="text" ref={inputRef} />;
};

class App extends Component {
  state = {
    value: "",
  };

  handleSubmit = (event) => {
    e.preventDefault();
    this.setState({ value: this._input.value });
  };

  render() {
    const { value } = this.state;
    return (
      <div>
        <h3>Value: {value}</h3>
        <Input inputRef={(node) => (_input = node)} />
        <button onClick={(e) => this.handleSubmit(e)}>Submit</button>
      </div>
    );
  }
}
```

- Start with simple component
- Create ref in constructor, add ref to DOM element
- Refine with constructorless syntax
- Other common syntax for refs - no createRef
- Passing refs

</CodeStep>

</CodeSurferColumns>

---

# Class PropTypes and TypeScript

<Horizontal>

- PropTypes in many 3rd party libs, no tsx
- TSX as the standard

</Horizontal>

---

# Class PropTypes and TypeScript Example

<CodeSurferColumns themes={[nightOwl,nightOwl]}>

<CodeStep>

```js showNumbers title="BookList.jsx"
import React, { Component } from "react";

class BookList extends Component {
  render() {
    const { isDarkMode, title, books, icon } = this.props;

    return <div>...</div>;
  }
}

export default BookList;
```

- Start with a class

</CodeStep>

<CodeStep>

```js showNumbers title="BookList.jsx"
import React, { Component } from "react";
import PropTypes from "prop-types";

class BookList extends Component {
  render() {
    const { isDarkMode, pageTitle, books, icon, onIconClicked } = this.props;

    return <div>...</div>;
  }
}

BookList.propTypes = {
  isDarkMode: PropTypes.bool,
  pageTitle: PropTypes.string,
  books: PropTypes.arrayOf(
    PropTypes.shape({
      title: PropTypes.string,
      date: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),
    })
  ),
  icon: PropTypes.elementType,
  onIconClicked: PropTypes.func,
};

export default BookList;
```

- Start with a class
- Define shapes of props

</CodeStep>

<CodeStep>

```js showNumbers title="BookList.tsx"
import React, { Component, ReactNode } from "react";

interface IBook {
  title: string;
  date: string | number;
}

interface IBookListProps {
  isDarkMode: boolean;
  pageTitle: string;
  books: IBook;
  icon: ReactNode;
  onIconClicked: () => void;
}

interface IBookListState {
  showAnimation: boolean;
}

class BookList extends Component<IBookListProps, IBookListState> {
  state = {
    showAnimation: false,
  };

  handleIconClicked(): void {
    const { showAnimation } = this.state;
    this.setState(() => ({ showAnimation: !showAnimation }));
  }

  render() {
    const { isDarkMode, pageTitle, books, icon, onIconClicked } = this.props;

    return <div>...</div>;
  }
}

export default BookList;
```

- Start with a class
- Define shapes of props
- Convert to TypeScript

</CodeStep>

</CodeSurferColumns>

---

<!-- Page - React Hooks -->

# React Hooks

<MainContent>
  <BasicGrid gridAutoFlow="row">
    <Steps>
      <div className="box box-badass p-2 text-center">
        <span>Class to Function</span>
      </div>
      <div className="box box-badass p-2 text-center">
        <span>useState</span>
      </div>
      <div className="box box-badass p-2 text-center">
        <span>useEffect</span>
      </div>
      <div className="box box-badass p-2 text-center">
        <span>useRef</span>
      </div>
      <div className="box box-badass p-2 text-center">
        <span>React.memo</span>
      </div>
      <div className="box box-badass p-2 text-center">
        <span>useCallback, useMemo</span>
      </div>
      <div className="box box-badass p-2 text-center">
        <span>useMyHook</span>
      </div>
      <div className="box box-badass p-2 text-center">
        <span>3rd Party Hooks</span>
      </div>
      <div className="box box-uranianBlue p-2 text-center">
        <span>Mini Redux - useContext, useReducer</span>
      </div>
    </Steps>
  </BasicGrid>
</MainContent>

---

# React Hooks Example

<IframeLoader
  src={`https://codesandbox.io/embed/framer-motion-2-animating-shared-layouts-1cpd0?fontsize=14&hidenavigation=1&theme=dark`}
  title={`Hooks example`}
/>

- useState, destructuring value and setter
- define functions before return
- onMyFn={myFn} vs. onMyFn={(val) => myFn(val)}

---

# Class to Function

<Horizontal>

- state to useState
- API calls to useEffect
- watchers to useEffect
- ref to useRef
- useCallback, useMemo to avoid rerenders
- useReducer, useContext
- Only use hooks at top-level - not in conditionals, loops, nested functions

</Horizontal>

---

# Class to Function Example

<CodeSurferColumns themes={[nightOwl,nightOwl]}>

<CodeStep>

```js showNumbers
import React, { Component } from "react";

class App extends Component {
  componentDidMount() {...}
  componentDidUpdate() {...}
  componentWillUnmount() {...}
  render() {
    return <>...</>;
  }
}

export default App;
```

- Start with a class

</CodeStep>

<CodeStep>

```js showNumbers
import React, { Component } from "react";

class REMOVEApp extends Component {
  componentDidMount() {...}
  componentDidUpdate() {...}
  componentWillUnmount() {...}
  render() {
    return <>...</>;
  }
}

const App = () => {
  return (<>...</>);
}

export default App;
```

- Start with a class
- Change to a function

</CodeStep>

<CodeStep>

```js showNumbers
import React, { Component } from "react";

class REMOVEApp extends Component {
  componentDidMount() {...}
  componentDidUpdate() {...}
  componentWillUnmount() {...}
  render() {
    return <>...</>;
  }
}

const App = () => {
  useEffect(() => {
    // componentDidMount functions
  }, []);

  return (<>...</>);
}

export default App;
```

- Start with a class
- Change to a function
- add useEffect with empty array for componentDidMount

</CodeStep>

<CodeStep>

```js showNumbers
import React, { Component } from "react";

class REMOVEApp extends Component {
  componentDidMount() {...}
  componentDidUpdate() {...}
  componentWillUnmount() {...}
  render() {
    return <>...</>;
  }
}

const App = ({title}) => {
  useEffect(() => {
    // componentDidMount functions
  }, []);

  useEffect(() => {
    // componentDidUpdate functions
  }, [title]);

  return (<>...</>);
}

export default App;
```

- Start with a class
- Change to a function
- add useEffect with empty array for componentDidMount
- useEffect for props watchers for componentDidUpdate

</CodeStep>

<CodeStep>

```js showNumbers
import React, { Component } from "react";

class REMOVEApp extends Component {
  componentDidMount() {...}
  componentDidUpdate() {...}
  componentWillUnmount() {...}
  render() {
    return <>...</>;
  }
}

const App = ({title}) => {
  useEffect(() => {
    // componentDidMount functions
  }, []);

  useEffect(() => {
    // componentDidUpdate functions
  }, [title]);

  useEffect(() => {
    return () => {
      // componentWillUnmount functions
    };
  }, []);

  return (<>...</>);
}

export default App;
```

- Start with a class
- Change to a function
- add useEffect with empty array for componentDidMount
- useEffect for props watchers for componentDidUpdate
- useEffect return function for componentWillUnmount

</CodeStep>

<CodeStep>

```js showNumbers 1:21
import React from "react";

const App = ({ title }) => {
  useEffect(() => {
    // componentDidMount functions
  }, []);

  useEffect(() => {
    // componentDidUpdate functions
  }, [title]);

  useEffect(() => {
    return () => {
      // componentWillUnmount functions
    };
  });

  return <>...</>;
};

export default App;
```

- Start with a class
- Change to a function
- add useEffect with empty array for componentDidMount
- useEffect for props watchers for componentDidUpdate
- useEffect return function for componentWillUnmount
- Remove class code

</CodeStep>

</CodeSurferColumns>

---

# useState

<Horizontal>

- understand destructuring syntax of getter and setter
- can be used with watcher useEffect functions

</Horizontal>

---

# useState example

<CodeSurferColumns themes={[nightOwl,nightOwl]}>

<CodeStep>

```js showNumbers
import React, { Component } from "react";

class App extends Component {
  state = {
    isDarkMode: false,
  };

  handleSetDarkMode() {
    const { isDarkMode } = this.state;
    this.setState({ isDarkMode: !isDarkMode });
  }

  render() {
    return (
      <>
        <button onClick={() => this.handleSetDarkMode()}>toggle</button>
      </>
    );
  }
}

export default App;
```

- Convert class to function

</CodeStep>

<CodeStep>

```js showNumbers
import React, { useState, Component } from "react";

class REMOVEApp extends Component {
  state = {
    isDarkMode: false,
  };

  handleSetDarkMode() {
    const { isDarkMode } = this.state;
    this.setState({ isDarkMode: !isDarkMode });
  }

  render() {
    return (
      <>
        <button onClick={() => this.handleSetDarkMode()}>toggle</button>
      </>
    );
  }
}

const App = () => {
  const [isDarkMode, setIsDarkMode] = useState(false);

  return (
    <>
      <button onClick={() => setIsDarkMode(!isDarkMode)}>toggle</button>
    </>
  );
};

export default App;
```

- Convert class to function
- useState, destructure getter/setter

</CodeStep>

<CodeStep>

```js showNumbers 1:13
import React, { useState } from "react";

const App = () => {
  const [isDarkMode, setIsDarkMode] = useState(false);

  return (
    <>
      <button onClick={() => setIsDarkMode(!isDarkMode)}>toggle</button>
    </>
  );
};

export default App;
```

- Convert class to function
- useState, destructure getter/setter
- Remove class remnants

</CodeStep>

<CodeStep>

```js showNumbers
import React, { useState } from "react";

const App = () => {
  const [isDarkMode, setIsDarkMode] = useState(false);
  const [count, setCount] = useState(0);

  return (
    <>
      <button onClick={() => setIsDarkMode(!isDarkMode)}>toggle</button>
      <button onClick={() => setCount(count + 1)}>count: {count}</button>
    </>
  );
};

export default App;
```

- Convert class to function
- useState, destructure getter/setter
- Remove class remnants
- counter example

</CodeStep>

<CodeStep>

```js showNumbers
import React, { useState, useEffect } from "react";
import isEmpty from 'lodash/isEmpty';

const App = () => {
  const [ apiError, setApiError ] = useState(null);
  const [ books, setBooks ] = useState([]);

  useEffect(async () => {
    // TODO rewrite
    try {
      const booksRes = await fetch('https://example.com/api/books');
      const books = await booksRes.json();
      setBooks(books);
      setApiError(false);
    } catch() {
      setApiError(true);
    }
  }, [])

  return (
    <ul>
      {!apiError && !isEmpty(books) && books.map( b => (
        <li key={b.id}>{b.title}</li>
      ))}
    </ul>
  );
};

export default App;
```

- Convert class to function
- useState, destructure getter/setter
- Remove class remnants
- counter example
- data collection example

</CodeStep>

</CodeSurferColumns>

---

# useEffect

<Horizontal>

- empty array for Mounting
- varibles in brackets to run when those values changed
- useing Memo to avoid rerenders
- callback function when unmounting / cleanup

</Horizontal>

---

# useEffect example

<CodeSurferColumns themes={[nightOwl,nightOwl]}>

<CodeStep>

```js showNumbers
import React, { useState, useEffect } from 'react';

const BookList = () => {
  const [books, setBooks] = useState([]);

  useEffect( async () => {
    try {
      const booksRes = await fetch('...');
      const books = await booksRes.json();
      setBooks(books);
    } catch(error) {}
  }, []);

  return (
    <section>
      ...
    </section>>
  );
}

export default BookList;
```

- useEffect empty array on mount

</CodeStep>

<CodeStep>

```js showNumbers
import React, { useState, useEffect } from 'react';

const BookList = ({bookListType}) => {
  const [books, setBooks] = useState([]);

  useEffect( async () => {
    try {
      const booksRes = await fetch('...');
      const books = await booksRes.json();
      setBooks(books);
    } catch(error) {}
  }, [bookListType]);

  return (
    <section>
      ...
    </section>>
  );
}

export default BookList;
```

- useEffect empty array on mount
- add to dependency array to run on changes

</CodeStep>

<CodeStep>

```js showNumbers
import React, { useState, useEffect } from 'react';

const BookList = ({bookListType}) => {
  const [books, setBooks] = useState([]);

  useEffect(() => {
    let timeoutHandle = window.setTimeout(() => {...});

    const getData = async () => {
      try {
        const booksRes = await fetch('...');
        const books = await booksRes.json();
        setBooks(books);
      } catch(error) {...}
      }
    getData();

    return () => {
      if (timeoutHandle) {
        clearTimeout(timeoutHandle)
      }
    }
  }, [bookListType]);

  return (
    <section>
      ...
    </section>>
  );
}

export default BookList;
```

- useEffect empty array on mount
- add to dependency array to run on changes
- useEffect return function for cleanup

</CodeStep>

<CodeStep>

```js showNumbers title="GoCoach AutoFocus.tsx" 1:25
import React, { FC, useEffect, useRef } from "react";
import "./AutoFocus.scss";

interface IAutoFocusProps {
  children?: React.ReactNode;
}

const AutoFocus: FC<IAutoFocusProps> = ({ children }) => {
  // prettier-ignore
  const elementRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    if (elementRef !== null && elementRef.current !== null) {
      elementRef.current.focus();
    }
  }, [elementRef]);

  return (
    <span tabIndex={0} ref={elementRef} className="auto-focus">
      {children}
    </span>
  );
};

export default AutoFocus;
```

- useEffect empty array on mount
- add to dependency array to run on changes
- useEffect return function for cleanup
- TypeScript auto focus wrapper example

</CodeStep>

<CodeStep>

```js showNumbers title="GoCoach FadeIn.tsx" 1:32
import React, { ReactNode, FC, useState, useEffect } from "react";
import { TransitionGroup, CSSTransition } from "react-transition-group";
import "./FadeIn.scss";

interface IFadeInProps {
  stagger?: number;
  children?: ReactNode;
}

const FadeIn: FC<IFadeInProps> = ({ stagger = 500, children }) => {
  const [showItem, setShowItem] = useState(false);

  useEffect(() => {
    setShowItem(true);
  }, []);

  return (
    <TransitionGroup className="gc-fade-in">
      {showItem && (
        <CSSTransition
          key="gc-fade-in"
          timeout={stagger}
          classNames="gc-fade-in__item"
        >
          {children}
        </CSSTransition>
      )}
    </TransitionGroup>
  );
};

export default FadeIn;
```

- useEffect empty array on mount
- add to dependency array to run on changes
- useEffect return function for cleanup
- TypeScript auto focus wrapper example
- TypeScript fade in example

</CodeStep>

</CodeSurferColumns>

---

# useRef

<Horizontal>

- values persist lifetime of component
- DOM manipulation
- tracking values

</Horizontal>

---

# useRef Example

<CodeSurferColumns themes={[nightOwl,nightOwl]}>

<CodeStep>

```js showNumbers
import React, { useRef } from "react";

const TextInputWithFocusButton = () => {
  const inputEl = useRef(null);

  const handleButtonClick = () => {
    inputEl.current.focus();
  };

  return (
    <>
      <input ref={inputEl} type="text" />
      <button onClick={handleButtonClick}>Focus the input</button>
    </>
  );
};

export default TextInputWithFocusButton;
```

- Similar to Class-based approach with useRef

</CodeStep>

<CodeStep>

```js showNumbers
import React, { useRef } from "react";

const Form = () => {
  const nameEl = useRef(null);
  const passwordEl = useRef(null);

  const handleSubmit = (e) => {
    e.preventDefault();

    const payload = {
      name: nameEl.current.value,
      password: passwordEl.current.value,
    }
    ...
  }

  return (
    <form onSubmit={handleSubmit}>
      <input ref={nameEl} type="text" placeholder="Enter username"/>
      <input ref={passwordEl} type="password" />
      <input type="submit">Submit</input>
    </form>
  );
};

export default Form;
```

- Similar to Class-based approach with useRef
- useRef for forms

</CodeStep>

</CodeSurferColumns>

---

# React.memo

<Horizontal>

- For memoized callbacks (avoid using memory to recalculate function definition)
- only changes if a dependency changes (avoids unnecessary rerenders)
- memory heavy, only use with components that need optimization
- avoid with components with props that change frequently

</Horizontal>

---

# React.memo example

<CodeSurferColumns themes={[nightOwl,nightOwl]}>

<CodeStep>

```js showNumbers
import React, { memo } from "react";

const MyMemoizedLongList = memo(({ items = [], onRemoveItem }) => {
  const sortedFilteredItems = items
    .filter((item) => item.active)
    .sort((a, b) => a.created - b.created);

  return (
    <ul>
      {sortedFilteredItems.map((item) => (
        <li key={item.id}>
          <span>{item.description}</span>
          <button onClick={() => onRemoveItem(item.id)}>Remove</button>
        </li>
      ))}
    </ul>
  );
});

export default MyMemoizedLongList;
```

- Available in React v.16.6
- Avoids rerenders when props do not change

</CodeStep>

<CodeStep>

```js showNumbers
import React, { memo } from "react";
import isEqual from "lodash/isEqual"; // deep comparison

const MyMemoizedLongList = memo(
  ({ items = [], onRemoveItem }) => {
    const sortedFilteredItems = items
      .filter((item) => item.active)
      .sort((a, b) => a.created - b.created);

    return (
      <ul>
        {sortedFilteredItems.map((item) => (
          <li key={item.id}>
            <span>{item.description}</span>
            <button onClick={() => onRemoveItem(item.id)}>Remove</button>
          </li>
        ))}
      </ul>
    );
  },
  (prevProps, nextProps) => {
    if (isEqual(prevProps.items, nextProps.items)) {
      return true; // props equal, do not update component
    }
    return false; // props not equal, update component
  }
);

export default MyMemoizedLongList;
```

- Available in React v.16.6
- Avoids rerenders when props do not change
- Second arg function to allow rerender on deep comparison

</CodeStep>

<CodeStep>

```js showNumbers
import Reactfrom "react";
import isEqual from "lodash/isEqual";

const MyMemoizedLongList = ({ items = [], onRemoveItem }) => {
  const sortedFilteredItems = items
    .filter((item) => item.active)
    .sort((a, b) => a.created - b.created);

  return (
    <ul>
      {sortedFilteredItems.map((item) => (
        <li key={item.id}>
          <span>{item.description}</span>
          <button onClick={() => onRemoveItem(item.id)}>Remove</button>
        </li>
      ))}
    </ul>
  );
};

export default React.memo(MyMemoizedLongList, (prevProps, nextProps) => {
  if (isEqual(prevProps.items, nextProps.items)) {
    return true;
  }
  return false;
});
```

- Available in React v.16.6
- Avoids rerenders when props do not change
- Second arg function to allow rerender on deep comparison
- other common syntax

</CodeStep>

</CodeSurferColumns>

---

# useCallback + useMemo

<Horizontal>

- useCallback for repeated operations
- useMemo for the same thing
- avoid using memory to recalculate function definition
- only called if a dependency changes (avoids unnecessary rerenders)

```js
useCallback(() => {}, [dep1, dep2]);
useMemo(() => () => {}, [dep1, dep2]);
```

</Horizontal>

---

# useCallback + useMemo Example

<IframeLoader
  src="https://codesandbox.io/embed/pedantic-euler-tftij?autoresize=1&codemirror=1&expanddevtools=1&fontsize=14&hidenavigation=1&theme=dark"
  title={"useCallback useMemo example"}
/>

<Notes>

- check console for renders
- useMemo has slightly different syntax
- useCallback vs. useMemo?

</Notes>

---

# Custom Hooks

<Horizontal>

- Use to wrap other hooks

</Horizontal>

---

# Custom Hooks Examples

<CodeSurferColumns themes={[nightOwl,nightOwl]}>

<CodeStep>

```js showNumbers title="GoCoach useWindowSize.ts"
import { useState, useEffect } from 'react';

const getSize = () => ({
  innerHeight: window.innerHeight,
  innerWidth: window.innerWidth,
  outerHeight: window.outerHeight,
  outerWidth: window.outerWidth,
});

const useWindowSize = () => {
  const [windowSize, setWindowSize] = useState(getSize());

  const handleResize () => {
    setWindowSize(getSize());
  }

  useEffect(() => {
    window.addEventListener('resize', handleResize);
    return () => {
      window.removeEventListener('resize', handleResize);
    };
  }, []);

  return windowSize;
}

export default useWindowSize;
```

- Example - useWindowSize

</CodeStep>

<CodeStep>

```js showNumbers title="GoCoach useLocalStorage.ts"
import { useState } from 'react';

const useLocalStorage = <T>(
  key: string,
  initialValue: T
): [T, (valueToStore: T) => void] => {
  const [storedValue, setStoredValue] = useState<T>((): T => {
    try {
      const item = window.localStorage.getItem(key);
      return (item ? JSON.parse(item) : initialValue) as T;
    } catch (error) {
      console.error(error);
      return initialValue as T;
    }
  });

  const setValue = (value: any) => {
    try {
      const valueToStore = value instanceof Function ? value(storedValue) : value;
      setStoredValue(valueToStore);
      window.localStorage.setItem(key, JSON.stringify(valueToStore));
    } catch (error) {
      console.error(error);
    }
  };

  return [storedValue as T, setValue];
}

export default useLocalStorage;
```

- Example - useWindowSize
- Example - useLocalStorage

</CodeStep>

</CodeSurferColumns>

<Notes>

- TS can get quite complex, reach for 3rd party solutions
- useWindowSize notice only returning state value, updating via window events

</Notes>

---

# 3rd Party Hooks

<Horizontal>

- React Router
- React Hook Form
- Redux toolkit
- rehooks for tons of packages
- <a href="https://github.com/rehooks/awesome-react-hooks" target="_blank">
    Github page awesome-hooks-react
  </a>

</Horizontal>

---

# ahooks - by Alibaba

<IframeLoader
  src={`https://ahooks.js.org/hooks/async`}
  title={`ahooks by Alibaba`}
/>

---

# useReducer

<Horizontal>

- alternative to useState
- use with useContext for mini Redux

</Horizontal>

---

# useState to useReducer example

<CodeSurferColumns themes={[nightOwl,nightOwl]}>

<CodeStep>

```js showNumbers title="useState"
import React, { useState } from "react";

export default () => {
  const [count, setCount] = useState(0);

  return (
    <div>
      <h1>Count: {count}</h1>
      <button onClick={setCount(count + 1)}>+</button>
      <button onClick={setCount(count - 1)}>-</button>
    </div>
  );
};
```

- start with useState

</CodeStep>

<CodeStep>

```js showNumbers title="useReducer"
import React, { useReducer } from "react";

const reducer = (state, action) => {
  switch(action.type) {
    case: 'INCREMENT':
      return state + 1;
    case: 'INCREMENT':
      return state - 1;
    default:
      return state;
  }
}

export default () => {
  const [count, dispatch] = useReducer(reducer, 0);

  return (
    <div>
      <h1>Count: {count}</h1>
      <button onClick={dispatch({ type: 'INCREMENT'})}>+</button>
      <button onClick={dispatch({ type: 'DECREMENT'})}>-</button>
    </div>
  );
};
```

- start with useState
- refactored to useReducer

</CodeStep>

<CodeStep>

```js showNumbers title="approaching Redux"
import React, { useReducer } from "react";

const initialStore = {
  count: 0,
};

const reducer = (store, action) => {
  switch(action.type) {
    case: 'UPDATE_COUNT':
      return {
        ...store,
        count: store.count + action.value,
      }
    default:
      return store;
  }
}

export default () => {
  const [{count}, dispatch] = useReducer(reducer, initialStore);

  return (
    <div>
      <h1>Count: {count}</h1>
      <button onClick={dispatch({ type: 'UPDATE_COUNT', value: 1 })}>+</button>
      <button onClick={dispatch({ type: 'UPDATE_COUNT', value: -1 })}>-</button>
    </div>
  );
};
```

- start with useState
- refactored to useReducer
- refactor to be closer to Redux - pass vals, rename to store

</CodeStep>

</CodeSurferColumns>

---

# useContext

<Horizontal>

- a portal to any component
- basic implementations for app-wide settings
- more complex as alternative to Redux

</Horizontal>

---

# useContext Example

<CodeSurferColumns themes={[nightOwl,nightOwl]}>

<CodeStep>

```js showNumbers title="useContext"
import React from "react";

const App = () => {
  return (
    <div>
      <ThemedButton />
    </div>
  );
};

const ThemedButton = () => {
  return <button>button</button>;
};
```

- start with an app and a button component

</CodeStep>

<CodeStep>

```js showNumbers title="useContext"
import React, { createContext } from "react";

const themes = {
  light: { foreground: "#000000", background: "#eeeeee" },
  dark: { foreground: "#ffffff", background: "#222222" },
};

const ThemeContext = createContext(themes.dark);

const App = () => {
  return (
    <ThemeContext.Provider>
      <ThemedButton />
    </ThemeContext.Provider>
  );
};

const ThemedButton = () => {
  return <button>button</button>;
};
```

- start with an app and a button component
- Create a context with default values, wrap App with Provider

</CodeStep>

<CodeStep>

```js showNumbers title="useContext"
import React, { createContext, useContext } from "react";

const themes = {
  light: { foreground: "#000000", background: "#eeeeee" },
  dark: { foreground: "#ffffff", background: "#222222" },
};

const ThemeContext = createContext(themes.dark);

const App = () => {
  return (
    <ThemeContext.Provider>
      <ThemedButton />
    </ThemeContext.Provider>
  );
};

const ThemedButton = () => {
  const theme = useContext(ThemeContext);
  return (
    <button
      style={{
        background: theme.background,
        color: theme.foreground,
      }}
    >
      styled button
    </button>
  );
};
```

- start with an app and a button component
- create a context with default values, wrap App with Provider
- pull out values in any component with useContext()

</CodeStep>

<CodeStep>

```js showNumbers title="useContext"
import React, { createContext, useContext } from "react";

const themes = {
  light: { foreground: "#000000", background: "#eeeeee" },
  dark: { foreground: "#ffffff", background: "#222222" },
};

const ThemeContext = createContext(themes.dark);

const App = () => {
  return (
    <ThemeContext.Provider>
      <ThemedButton />
    </ThemeContext.Provider>
  );
};

const ThemedButton = () => {
  const theme = useContext(ThemeContext);
  return (
    <button
      style={{
        background: theme.background,
        color: theme.foreground,
      }}
    >
      styled button
    </button>
  );
};
```

- start with an app and a button component
- create a context with default values, wrap App with Provider
- pull out values in any component with useContext()
- but how do you change values in the context?... mini Redux

</CodeStep>

</CodeSurferColumns>

---

# Mini Redux - useContext, useReducer

<Horizontal>

- Less boilerplate than Redux
- Can have multiple contexts/stores, Redux can only have one store
- Caveat - no time travel dev tools

</Horizontal>

---

# Mini Redux Example - useContext, useReducer

<CodeSurferColumns themes={[nightOwl,nightOwl]}>

<CodeStep>

```js showNumbers title="AppReducer.ts"
import IStore from "./IStore";
import IAction from "./IAction";
import APP_ACTIONS from "./APP_ACTIONS";

const appReducer = (store: IStore, action: IAction) => {
  switch (action.type) {
    case APP_ACTIONS.TOGGLE_LEFT_DRAWER:
      return {
        ...store,
        isLeftDrawerOpen: action.value,
      };
    case APP_ACTIONS.TOGGLE_DARK_MODE:
      return {
        ...store,
        isDarkMode: action.value,
      };
    case APP_ACTIONS.SET_IS_LOADING:
      return {
        ...store,
        isLoading: action.value,
      };
    default:
      return { ...store };
  }
};

export default appReducer;
```

- example reducer file

</CodeStep>

<CodeStep>

```js showNumbers title="APP_ACTIONS.ts"
enum APP_ACTIONS {
  SET_IS_LOADING = 'APP_ACTIONS.SET_IS_LOADING',
  TOGGLE_DARK_MODE = 'APP_ACTIONS.TOGGLE_DARK_MODE',
  TOGGLE_LEFT_DRAWER = 'APP_ACTIONS.TOGGLE_LEFT_DRAWER',
  LOG_IN = 'APP_ACTIONS.LOG_IN',
}

export default APP_ACTIONS;
```

- example reducer file
- example actions file

</CodeStep>

<CodeStep>

```js showNumbers title="initialStore.ts"
import IStore from "./IStore";

const initialStore: IStore = {
  isLoading: true,
  isLeftDrawerOpen: false,
  isDarkMode: true,
};

export default initialStore;
```

- example reducer file
- example actions file
- example initialStore file

</CodeStep>

<CodeStep>

```js showNumbers title="AppStore.ts" 1:37
import React, {
  createContext,
  useContext,
  useReducer,
  FC,
  ReactNode,
  Dispatch,
} from 'react';
import IState from './IStore';
import IAction from './IAction';
import initialStore from './initialStore';
export const StoreContext = createContext<any>({});

interface IStoreProvider {
  reducer: (state: IState, action: IAction) => IState;
  initialStore: IState;
  children: ReactNode;
}

const StoreProvider: FC<IStoreProvider> = ({
  reducer,
  initialStore,
  children,
}) => {
  const [state, dispatch] = useReducer(reducer, initialStore);

  return (
    <StoreContext.Provider value={[state, dispatch]}>
      {children}
    </StoreContext.Provider>
  );
};

export const useStoreValue = (): [IState, Dispatch<IAction>] =>
  useContext(StoreContext) as any;

export default StoreProvider;
```

- example reducer file
- example actions file
- example initialStore file
- example AppStore file

</CodeStep>

<CodeStep>

```js showNumbers title="Gatsby top-layout.tsx" 1:19
import StoreProvider from '../../context';
import initialStore from '../../context/initialStore';
import AppReducer from '../../context/AppReducer';
...
const TopLayout = ({ children, theme }: ITopLayout) => {
  return (
    <StoreProvider initialStore={initialStore} reducer={AppReducer}>
      <ThemeWrapper theme={theme}>
        <Header />
        <MainFooterWrapper>
          <Main>{children}</Main>
          <Footer />
        </MainFooterWrapper>
      </ThemeWrapper>
    </StoreProvider>
  );
};

export default TopLayout;
```

- example reducer file
- example actions file
- example initialStore file
- example AppStore file
- example top-level file in Gatsby

</CodeStep>

<CodeStep>

```js showNumbers title="ThemeWrapper.tsx" 1:26
const ThemeWrapper = ({ theme, children }: IThemeWrapper) => {
  const prefersDarkMode = useMediaQuery("(prefers-color-scheme: dark)");
  const [{ isDarkMode }, dispatch] = useStoreValue();

  useEffect(() => {
    dispatch({
      type: APP_ACTIONS.TOGGLE_DARK_MODE,
      value: prefersDarkMode,
    });
  }, [prefersDarkMode]);

  const adjustedTheme = useMemo(() => {
    return isDarkMode ? theme.darkTheme : theme.lightTheme;
  }, [isDarkMode]);

  return (
    <ThemeTopLayout theme={adjustedTheme}>
      <CssBaseline />
      <>
        <PageBackdropLoader />
        {children}
        <LeftDrawer />
      </>
    </ThemeTopLayout>
  );
};
```

- example reducer file
- example actions file
- example initialStore file
- example AppStore file
- example top-level file in Gatsby
- example wrapper using store value

</CodeStep>

<CodeStep>

```js showNumbers title="LeftDrawer.tsx" 1:25
...
import { makeStyles } from '@material-ui/styles';
...
const useStyles = makeStyles((theme: Theme) => ({ ... });

const LeftDrawer = ({}: ILeftDrawer) => {
  const [{ isDarkMode, isLeftDrawerOpen }, dispatch] = useStoreValue();
  const classes = useStyles();

  const handleClose = () => {
    dispatch({
      type: APP_ACTIONS.TOGGLE_LEFT_DRAWER,
      value: false,
    });
  };

  const handleOpen = () => {
    dispatch({
      type: APP_ACTIONS.TOGGLE_LEFT_DRAWER,
      value: true,
    });
  };
  ...
  return (...)
}
```

- example reducer file
- example actions file
- example initialStore file
- example AppStore file
- example top-level file in Gatsby
- example wrapper using store value
- example slidebar using store value

</CodeStep>

</CodeSurferColumns>

<Notes>

- reducers are just switch statements
- good idea to avoid magic strings - enums
- separate files for easy cognitive navigation
- useReducer destructuring, passing in value to store
- useStoreValue as custom hook - just returns useContext
- wrapping apps, wrapping themes
- passing initialStore and reducer
- grabbing values from useStoreValue
- dispatch shape of type and value
- more examples of hooks - useStyoles

</Notes>

---

# Mini Redux Example - CodeQuizPro

<IframeLoader
  src={`https://heuristic-shockley-4b794e.netlify.app/`}
  title={"CodeQuizPro demo built with Gatsby"}
/>

---

# Class Context Example

<IframeLoader
  src={"https://d6jtdo9jhz4ae.cloudfront.net/"}
  title={"CCC Taft Guided Pathways"}
/>

---

<!-- Page - Redux -->

# Redux

<MainContent maxWidth={"100%"}>
  <BasicGrid gridAutoFlow="row">
    <Steps>
      <div className="box box-uranianBlue p-2 text-center">
        <span>initialStore(s)</span>
      </div>
      <div className="box box-uranianBlue p-2 text-center">
        <span>Actions</span>
      </div>
      <div className="box box-uranianBlue p-2 text-center">
        <span>Action types</span>
      </div>
      <div className="box box-uranianBlue p-2 text-center">
        <span>reducers</span>
      </div>
      <div className="box box-uranianBlue p-2 text-center">
        <span>selectors</span>
      </div>
      <div className="box box-uranianBlue p-2 text-center">
        <span>thunks</span>
      </div>
      <div className="box box-uranianBlue p-2 text-center">
        <span>connect()</span>
      </div>
      <div className="box box-uranianBlue p-2 text-center">
        <span>mapStateToProps</span>
      </div>
      <div className="box box-uranianBlue p-2 text-center">
        <span>mapDispatchToProps</span>
      </div>
    </Steps>
  </BasicGrid>
</MainContent>

---

# Redux Devtools

<Split>

<img
  src="https://user-images.githubusercontent.com/7957859/48663602-3aac4900-ea9b-11e8-921f-97059cbb599c.png"
  title="Chrome Extension Redux Devtools"
/>

- Browser extension
- manually alter state
- time travel - see state changes

</Split>

---

# Redux Example

<CodeSurferColumns themes={[nightOwl,nightOwl]}>

<CodeStep>

```js showNumbers title="Class component setup - NoteAffect example"
import React, { Component } from 'react';
import { createStore, combineReducers, applyMiddleware } from 'redux';
import { Provider } from 'react-redux';
import thunk from 'redux-thunk';

const store = createStore(
  combineReducers(Reducers),
  process.env.NODE_ENV !== 'production' &&
    window.__REDUX_DEVTOOLS_EXTENSION__ &&
    window.__REDUX_DEVTOOLS_EXTENSION__(),
  applyMiddleware(thunk);

class App extends Component {
  ...
  render() {
    return (
      <Provider store={store}>
        ...
      </Provider>
    );
  }
}
```

- Class-based React - add devtools, thunks for API calls, wrap with a Provider passing in the store

</CodeStep>

<CodeStep>

```js showNumbers title="Hook component setup - Cisco example"
import React, { Suspense } from "react";
import { Provider } from "react-redux";
import { createStore, applyMiddleware, compose } from "redux";
import rootReducer from "./redux/reducers";
import ReduxThunk from "redux-thunk";
import Loader from "./components/Loader";

const composeEnhancer = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;

export const store = createStore(
  rootReducer,
  composeEnhancer(applyMiddleware(ReduxThunk))
);

const App = () => {
  return (
    <Suspense fallback={<Loader />}>
      <Provider store={store}>...</Provider>
    </Suspense>
  );
};
```

- Class-based React - add devtools, thunks for API calls, wrap with a Provider passing in the store
- Hooks based is similar - devtools, thunks, Provider

</CodeStep>

<CodeStep>

```js showNumbers title="npm i redux react-redux"
export const todosInitialStore = {
  todos: [],
};

export const appInitialStore = {
  isLoading: false,
};
```

- Start with the initialStores (default values for data, flags)

</CodeStep>

<CodeStep>

```js showNumbers 4:6
export const dataInitialStore = {...};
export const appInitialStore = {...};

export const ADD_TODO = "ADD_TODO";
export const REMOVE_TODO = "REMOVE_TODO";
export const SET_IS_LOADING = "SET_IS_LOADING";
```

- Start with the initialStores (default values for data, flags)
- Add Action types (to avoid magic strings, passed as value to dispatch)

</CodeStep>

<CodeStep>

```js showNumbers 8:19
export const dataInitialStore = {...};
export const appInitialStore = {...};

export const ADD_TODO = "ADD_TODO";
export const REMOVE_TODO = "REMOVE_TODO";
export const SET_IS_LOADING = "SET_IS_LOADING";

export const AddTodo = (todo) => ({
  type: ADD_TODO,
  value: todo
});
export const RemoveTodo = (todo) => ({
  type: REMOVE_TODO,
  value: todo,
});
export const SetIsLoading = (isLoading) => ({
  type: REMOVE_TODO,
  value: isLoading,
});

```

- Start with the initialStores (default values for data, flags)
- Add Action types (to avoid magic strings, passed as value to dispatch)
- Add Actions (pass through objects for reducers)

</CodeStep>

<CodeStep>

```js showNumbers 12:30
export const todosInitialStore = {...};
export const appInitialStore = {...};

export const ADD_TODO = "ADD_TODO";
export const REMOVE_TODO = "REMOVE_TODO";
export const SET_IS_LOADING = "SET_IS_LOADING";

export const AddTodo = (todo) => ({...});
export const RemoveTodo = (todo) => ({...});
export const SetIsLoading = (isLoading) => ({...});

export const dataReducer = (
  dataStore = dataInitialStore,
  action,
) => {
  switch(action.type) {
    case ADD_TODO:
      return {
        ...dataStore,
        todos: dataStore.todos.concat(todo),
      }
    case REMOVE_TODO:
      return {
        ...dataStore,
        todos: dataStore.todos.filter(todo => todo.id !== value.id)
      }
    default:
      return dataStore;
  }
}

```

- Start with the initialStores (default values for data, flags)
- Add Action types (to avoid magic strings, passed as value to dispatch)
- Add Actions (pass through objects for reducers)
- Add a reducer for data (switch statement to change the store)

</CodeStep>

<CodeStep>

```js showNumbers 14:27
export const todosInitialStore = {...};
export const appInitialStore = {...};

export const ADD_TODO = "ADD_TODO";
export const REMOVE_TODO = "REMOVE_TODO";
export const SET_IS_LOADING = "SET_IS_LOADING";

export const AddTodo = (todo) => ({...});
export const RemoveTodo = (todo) => ({...});
export const SetIsLoading = (isLoading) => ({...});

export const dataReducer = (...) => {...}

export const appReducer = (
  appStore = appInitialStore,
  action,
) => {
  switch(action.type) {
    case SET_IS_LOADING:
      return {
        ...appStore,
        isLoading: action.value,
      }
    default:
      return appStore;
  }
}

```

- Start with the initialStores (default values for data, flags)
- Add Action types (to avoid magic strings, passed as value to dispatch)
- Add Actions (pass through objects for reducers)
- Add a reducer for data (switch statement to change the store)
- Add a reducer for app (switch statement to change the store)

</CodeStep>

<CodeStep>

```js showNumbers 14:27
export const todosInitialStore = {...};
export const appInitialStore = {...};

export const ADD_TODO = "ADD_TODO";
export const REMOVE_TODO = "REMOVE_TODO";
export const SET_IS_LOADING = "SET_IS_LOADING";

export const AddTodo = (todo) => ({...});
export const RemoveTodo = (todo) => ({...});
export const SetIsLoading = (isLoading) => ({...});

export const dataReducer = (...) => {...}
export const appReducer = (...) => {...}

export const getTodosSelector = store => store.data.todos;
export const getAppIsLoadingSelector = store => store.app.isLoading;

```

- Start with the initialStores (default values for data, flags)
- Add Action types (to avoid magic strings, passed as value to dispatch)
- Add Actions (pass through objects for reducers)
- Add a reducer for data (switch statement to change the store)
- Add a reducer for app (switch statement to change the store)
- Add selectors (functions to grab a piece of the store)

</CodeStep>

<CodeStep>

```js showNumbers 1:14
import { createStore, combineReducers } from 'redux';

...

export const dataReducer = (...) => {...}
export const appReducer = (...) => {...}

export const reducers = combineReducers({
  data: dataReducer,
  app: appReducer
});
export const configureStore = () => {
  createStore(reducers),
}
```

- Start with the initialStores (default values for data, flags)
- Add Action types (to avoid magic strings, passed as value to dispatch)
- Add Actions (pass through objects for reducers)
- Add a reducer for data (switch statement to change the store)
- Add a reducer for app (switch statement to change the store)
- Add selectors (functions to grab a piece of the store)
- Combine reducers, configure store (to make available to the app...)

</CodeStep>

<CodeStep>

```js showNumbers title="npm i redux-thunk redux-devtools-extension"
import { createStore, combineReducers, applyMiddleware } from 'redux';
import thunk from 'redux-thunk';

...

export const reducers({
  data: dataReducer,
  app: appReducer
});
export const configureStore = () => {
  createStore(
    reducers,
    composeWithDevTools(
      applyMiddleware(thunk)
    )
  ),
}
```

- Start with the initialStores (default values for data, flags)
- Add Action types (to avoid magic strings, passed as value to dispatch)
- Add Actions (pass through objects for reducers)
- Add a reducer for data (switch statement to change the store)
- Add a reducer for app (switch statement to change the store)
- Add selectors (functions to grab a piece of the store)
- Combine reducers (to make available to the app...)
- Configure thunk, devtools (actions for async operations, API calls)

</CodeStep>

<CodeStep>

```js showNumbers
import { createStore, combineReducers, applyMiddleware } from 'redux';
import thunk from 'redux-thunk';
...
// Action
export const removeTodo = todo => ({
    type: REMOVE_TODO,
    payload: { todo },
});
...
// Thunk
export const removeTodoThunk = id => async dispatch => {
  try {
      const response = await fetch(`http://localhost:8080/todos/${id}`, {
          method: 'delete'
      });
      const removedTodo = await response.json();
      dispatch(removeTodo(removedTodo));
  } catch (e) {
      dispatch(displayAlert(e));
  }
}

export const reducers({
  data: dataReducer,
  app: appReducer
});
export const configureStore = () => {
  createStore(
    reducers,
    composeWithDevTools(
      applyMiddleware(thunk)
    )
  ),
}
```

- Start with the initialStores (default values for data, flags)
- Add Action types (to avoid magic strings, passed as value to dispatch)
- Add Actions (pass through objects for reducers)
- Add a reducer for data (switch statement to change the store)
- Add a reducer for app (switch statement to change the store)
- Add selectors (functions to grab a piece of the store)
- Combine reducers (to make available to the app...)
- Configure thunk, devtools (actions for async operations, API calls)
- Add thunks for async actions

</CodeStep>

<CodeStep>

```js showNumbers 1:31
import React, { useEffect } from "react";
import { connect } from "react-redux";

const TodoList = ({ todos, onRemovePressed, isLoading, startLoadingTodos }) => {
  useEffect(() => {
    startLoadingTodos();
  }, []);

  return (
    <ul>
      {todos.map((todo) => (
        <li key={todo.id}>
          <span>{todo.name}</span>
          <button onClick={onRemovePressed}>Remove</button>
        </li>
      ))}
    </ul>
  );
};

const mapStateToProps = (sore) => ({
  isLoading: getAppLoadingSelector(state),
  todos: getTodosSelector(state),
});

const mapDispatchToProps = (dispatch) => ({
  startLoadingTodos: () => dispatch(loadTodosThunk()),
  onRemovePressed: (id) => dispatch(removeTodoThunk(id)),
});

export default connect(mapStateToProps, mapDispatchToProps)(TodoList);
```

- Finally, get to the usage of this stuff!

</CodeStep>

</CodeSurferColumns>

---

# Example of Redux Thunk with Hooks

<IframeLoader
  src={`https://codesandbox.io/embed/74rykw70qq?codemirror=1&fontsize=14&hidenavigation=1&theme=dark`}
  title={`Hooks Redux Thunk`}
/>

---

# Million Ways to Store a Cat...

<IframeLoader
  src={`https://codesandbox.io/embed/lpp391lymm?fontsize=14&hidenavigation=1&theme=dark`}
  title={`State Management Example`}
/>

---

# Redux Toolkit (RTK)

<MainContent maxWidth={"80%"}>
  <BasicGrid gridAutoFlow="row">
    <Steps>
      <div className="box box-uranianBlue p-2 text-center">
        <span>configureStore()</span>
      </div>
      <div className="box box-uranianBlue p-2 text-center">
        <span>createSlice()</span>
      </div>
      <div className="box box-uranianBlue p-2 text-center">
        <span>createAction()</span>
      </div>
      <div className="box box-uranianBlue p-2 text-center">
        <span>createReducer()</span>
      </div>
      <div className="box box-uranianBlue p-2 text-center">
        <span>createAsyncThunk()</span>
      </div>
      <div className="box box-uranianBlue p-2 text-center">
        <span>useSelector()</span>
      </div>
      <div className="box box-uranianBlue p-2 text-center">
        <span>useDispatch()</span>
      </div>
    </Steps>
  </BasicGrid>
</MainContent>

---

# Redux Toolkit Main Points

<Horizontal>

- Concept of slices - configuration files for reducers and actions
- For API calls, still need to write thunks (can't do API calls in reducers)
- Million ways to skin a cat, again... many different implementations
- - Immer - can write mutable code, no worries about immutable syntax
- - NOTE - danger of writing unsafe mutable code, stick with creating new objects, arrays

</Horizontal>

---

# CRA Redux Template (Redux Toolkit)

<CodeSurferColumns themes={[nightOwl,nightOwl]}>

<CodeStep>

```js showNumbers
// Start new project
$ npx create-react-app my-app --template redux
// OR with TypeScript:
$ npx create-react-app my-app --template redux-typescript
```

- Starting with the redux template from CRA

</CodeStep>

<CodeStep>

```js showNumbers title="./src/app/store.js"
import { configureStore } from "@reduxjs/toolkit";
import counterReducer from "../features/counter/counterSlice";

export default configureStore({
  reducer: {
    counter: counterReducer,
  },
});
```

- Store config - adds reducer, imports a slice reducer

</CodeStep>

<CodeStep>

```js showNumbers title="./src/index.js"
import React from "react";
import ReactDOM from "react-dom";
import "./index.css";
import App from "./App";
import store from "./app/store";
import { Provider } from "react-redux";
import * as serviceWorker from "./serviceWorker";

ReactDOM.render(
  <React.StrictMode>
    <Provider store={store}>
      <App />
    </Provider>
  </React.StrictMode>,
  document.getElementById("root")
);

serviceWorker.unregister();
```

- Store config - adds reducer, imports a slice reducer
- Familiar Provider, passing in store

</CodeStep>

<CodeStep>

```js showNumbers title="./src/features/counter/counterSlice.js"
import { createSlice } from "@reduxjs/toolkit";

export const counterSlice = createSlice({
  name: "counter",
  initialState: {
    value: 0,
  },
  reducers: {
    increment: (state) => {
      // Redux Toolkit allows us to write "mutating" logic in reducers. It
      // doesn't actually mutate the state because it uses the Immer library,
      // which detects changes to a "draft state" and produces a brand new
      // immutable state based off those changes
      state.value += 1;
    },
    decrement: (state) => {
      state.value -= 1;
    },
    incrementByAmount: (state, action) => {
      state.value += action.payload;
    },
  },
});
export const { increment, decrement, incrementByAmount } = counterSlice.actions;

// The function below is called a thunk and allows us to perform async logic. It
// can be dispatched like a regular action: `dispatch(incrementAsync(10))`. This
// will call the thunk with the `dispatch` function as the first argument. Async
// code can then be executed and other actions can be dispatched
export const incrementAsync = (amount) => (dispatch) => {
  setTimeout(() => {
    dispatch(incrementByAmount(amount));
  }, 1000);
};
// The function below is called a selector and allows us to select a value from
// the state. Selectors can also be defined inline where they're used instead of
// in the slice file. For example: `useSelector((state) => state.counter.value)`
export const selectCount = (state) => state.counter.value;

export default counterSlice.reducer;
```

- Store config - adds reducer, imports a slice reducer
- Familiar Provider, passing in store
- Exploring the counterSlice:
- - default export at bottom as counterSlice.reducer
- - initial state defined in slice
- - actions in reducers object, uses Immer (BEWARE)
- - exporting actions from counterSlice.actions
- - Async thunk defined outside of slice, (passedVal) => (dispatch, getState) => ...
- - selector to grab piece of state

</CodeStep>

<CodeStep>

```js showNumbers title="./src/features/counter/counterSlice.js"
import { createSlice } from "@reduxjs/toolkit";

export const counterSlice = createSlice({
  name: "counter",
  initialState: {
    value: 0,
  },
  reducers: {
    increment: (state) => {
      /* state.value += 1; */
      return {
        ...state,
        value: state.value + 1,
      };
    },
    decrement: (state) => {
      /* state.value -= 1; */
      return {
        ...state,
        value: state.value - 1,
      };
    },
    incrementByAmount: (state, { type, payload }) => {
      state.value += payload;
    },
  },
});

export const { increment, decrement, incrementByAmount } = counterSlice.actions;

export const incrementAsync = (amount) => (dispatch) => {
  setTimeout(() => {
    dispatch(incrementByAmount(amount));
  }, 1000);
};

export const selectCount = (state) => state.counter.value;

export default counterSlice.reducer;
```

- Store config - adds reducer, imports a slice reducer
- Familiar Provider, passing in store
- Exploring the counterSlice:
- - default export at bottom as counterSlice.reducer
- - initial state defined in slice
- - actions in reducers object, uses Immer (BEWARE)
- - exporting actions from counterSlice.actions
- - Async thunk defined outside of slice, (passedVal) => (dispatch, getState) => ...
- - selector to grab piece of state
- BEWARE of Immer - traditional React cloning syntax
- actions have type and payload keys

</CodeStep>

<CodeStep>

```js showNumbers title="./src/features/counter/Counter.js"
import React, { useState } from "react";
import { useSelector, useDispatch } from "react-redux";
import {
  decrement,
  increment,
  incrementByAmount,
  incrementAsync,
  selectCount,
} from "./counterSlice";

export function Counter() {
  const count = useSelector(selectCount);
  const dispatch = useDispatch();
  const [incrementAmount, setIncrementAmount] = useState("2");

  return (
    <div>
        <button onClick={() => dispatch(increment())}>
          +
        </button>
        <span>{count}</span>
        <button onClick={() => dispatch(decrement())}>
          -
        </button>
      </div>
      <div>
        <input
          value={incrementAmount}
          onChange={(e) => setIncrementAmount(e.target.value)}
        />
        <button
          onClick={() =>
            dispatch(incrementByAmount(Number(incrementAmount) || 0))
          }
        >
          Add Amount
        </button>
        <button
          onClick={() => dispatch(incrementAsync(Number(incrementAmount) || 0))}
        >
          Add Async
        </button>
    </div>
  );
}
```

- Store config - adds reducer, imports a slice reducer
- Familiar Provider, passing in store
- Exploring the counterSlice:
- - default export at bottom as counterSlice.reducer
- - initial state defined in slice
- - actions in reducers object, uses Immer (BEWARE)
- - exporting actions from counterSlice.actions
- - Async thunk defined outside of slice, (passedVal) => (dispatch, getState) => ...
- - selector to grab piece of state
- BEWARE of Immer - traditional React cloning syntax
- Using values from the store - Counter.js
- - actions and selectors imported from slice
- - grab store value with useSelector
- - useDispatch, imported from react-redux
- - (clarification) has internal state for input el

</CodeStep>

</CodeSurferColumns>

---

# CRA Redux Template (Redux Toolkit) Sandbox

<IframeLoader
  src={`https://codesandbox.io/embed/jolly-platform-yw3jj?codemirror=1&fontsize=14&hidenavigation=1&theme=dark`}
  title={`CRA Redux Template Sandbox`}
/>

---

# Other Options for Global State: Recoil, XState

<div style={{display:'flex', width:'100%'}}>

<div style={{ height: "100vh", flex: "1 1 50%" }}>
  <IframeLoader src={`https://recoiljs.org`} title={`Recoil`} />
</div>

<div style={{ height: "100vh", flex: "1 1 50%" }}>
  <IframeLoader
    src={`https://xstate.js.org/docs/recipes/react.html`}
    title={`XState`}
  />
</div>

</div>

---

# Gotchas, Q&A

<MainContent>
  <BasicGrid gridAutoFlow="row">
    <Steps>
      <div className="box box-sandyBrown p-2 text-center">
        <span>.map, key (avoid using index as key)</span>
      </div>
      <div className="box box-sandyBrown p-2 text-center">
        <span>className vs. class, htmlFor vs. for</span>
      </div>
      <div className="box box-sandyBrown p-2 text-center">
        <span>props drilling</span>
      </div>
      <div className="box box-sandyBrown p-2 text-center">
        <span>Passing functions vs. arrow functions</span>
      </div>
      <div className="box box-sandyBrown p-2 text-center">
        <span>Defining async fns in useEffect</span>
      </div>
      <div className="box box-sandyBrown p-2 text-center">
        <span>stretching the body & #root</span>
      </div>
      <div className="box box-sandyBrown p-2 text-center">
        <span>VS Code snippets and shortcuts</span>
      </div>
      <div className="box box-sandyBrown p-2 text-center">
        <span>Using Immer in Redux Toolkit</span>
      </div>
    </Steps>
  </BasicGrid>
</MainContent>

---

# CRA Stretching the root

<CodeSurferColumns themes={[nightOwl,nightOwl]}>

<CodeStep>

```js showNumbers title="App.css"
html,
body {
  height: 100%;
}

#root {
  height: 100%;
  display: flex;
  flex-direction: column;
}

.App {
  flex: 1 1 100%;
  overflow: hidden;
  position: relative;
}
```

- Stretch out the root

</CodeStep>

</CodeSurferColumns>

---

# My Takeways

- Be able to READ class components and traditional Redux
- React Hooks for modern projects
- Understand basic state management - stores, actions, dispatchers
- Context for small to medium projects
- Redux Toolkit, Recoil, XState for medium-large projects

---

# Suggested Free Youtube Channels

- Traversy Media
- The Net Ninja
- Rowadz

---

# Activity - gather.town

<Split>

<div>
  <video autoPlay controls style={{ width: "100%", height: "100%" }}>
    <source
      src={`https://gather.town/images/site/landing_demo.mp4`}
      type="video/mp4"
    />
  </video>
</div>

<div style={{textAlign:'left', padding: '3rem'}}>
  <p>
    Room:{" "}
    <a
      href="https://gather.town/app/IxOEh5iBhXwxdTWg/ux-forum-react"
      target="_blank"
    >
      Gather.town ux-forum-react
      <br />
      <br />
      https://gather.town/app/IxOEh5iBhXwxdTWg/ux-forum-react
    </a>
  </p>
  <p>Password: uxforumreact</p>

  <p>Go Chat with:</p>
  <ul>
    <li>Mr. Class: David S.</li>
    <li>Mr. Hooks: Christian M.</li>
    <li>Mr. Context: Craig C.</li>
    <li>Mr. Toolkit: Ben S.</li>
    <li>Mr. Redux: Phil B.</li>
  </ul>
</div>

</Split>

<Notes>

- Class, Hooks, Redux, Context
- Volunteers, find a space
- 2 minutes per Room
- Last 2 minutes, free-for-all, see what happens
- End - meet in Conference Room

</Notes>

---

# Fin

<MainContent>
  <BasicGrid columns={1}>
    <GridItem className="box box-badass p-2 text-center">Questions?</GridItem>
  </BasicGrid>
</MainContent>
